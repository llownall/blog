+++
title = 'Хостим домашний публичный сервер'
date = 2024-01-04T10:00:00+07:00
draft = true
+++

# Что делаем
Захотелось мне иметь дома сервер на базе мини-пк с великой мощностью по меркам VPS
(Ryzen 7 5700U, 16/ 512 NVMe + возможность поставить HDD через USB 3.0), но есть некоторые домашние НО:
1. Серый айпи
2. Возможная нестабильность
3. ... - оставлю место для будущих непредвиденных проблем

В этом посте я опишу, как решаю проблему #1

# Решаем

Решить серость айпи можно несколькими способами: DynDNS, ngrok (наверно, краем уха слышал), покупка белого айпи 
у провайдера. Но поскольку у меня уже есть VPS, я буду использовать его.

Суть метода заключается в поднятии VPN между VPS и домашним сервером. Поступающий трафик проксируется с VPS 
на домашний сервер.

## Действия

### Создаем Wireguard VPN сервер на VPS

Этот шаг я пропускаю, т.к. использую VPS как раз для этих целей и VPN сервер (Wireguard) там уже есть.
Кстати, я использую [wg-easy](https://github.com/wg-easy/wg-easy)

### Подключаем наш домашний сервер к VPN

(Действия производились на Ubuntu 22.04)
- Устанавливаем [Wireguard](https://www.wireguard.com/install/#ubuntu-module-tools)
- Копируем .conf файл на сервер
- По [этой](https://www.ivpn.net/knowledgebase/linux/linux-autostart-wireguard-in-systemd/) инструкции добиваемся 
автоподключения VPN после рестарта сервера
- Проверяем смену IP (= успешное подключение к VPN): `curl ifconfig.me` 

### Настраиваем проксирование внешнего трафика

Последнее время в качестве прокси-сервера я всегда использую nginx. В этот раз всё без изменений.

До этого момента у меня не было единой точки входа, поэтому в этот раз я её создам. Этот прокси-сервер будет 
использоваться не только для проксирования траффика к домашнему серверу, но и для обработки траффика доменов, 
субдоменов и т.д. (мои мечты)

Я создам приватный репозиторий в GitHub, где размещу nginx.conf и Dockerfile. Работать nginx будет из-под docker. 
Обновление конфига будет происходить по коммиту с помощью GitHub Actions.


